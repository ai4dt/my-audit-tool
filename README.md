# 中国铁路建设集团审计系统

## 项目简介

这是一个基于Python Flask框架开发的智能审计系统，专为中国铁路建设集团设计。系统集成了AI大语言模型，能够自动化地从合同文件中提取关键信息，提高审计工作效率。

## 主要功能

### 🔐 用户认证系统
- 多角色用户管理（管理员、操作员、审计员、审计主管）
- 安全的登录认证机制
- 会话管理和权限控制

### 📄 合同管理
- 支持多种文件格式上传（PDF、DOCX、DOC、TXT）
- 拖拽式文件上传界面
- 文件列表管理和搜索功能
- 文件预览和下载

### 💭 提示词管理
- 创建和管理AI提示词模板
- 内置常用提示词模板（基础信息、财务条款、风险评估、时间节点）
- 提示词搜索和编辑功能
- 字符计数和内容预览

### 🔍 智能信息提取
- 集成Ollama本地AI模型
- 支持多种大语言模型（DeepSeek-R1:8b、Llama2、Qwen等）
- 实时提取进度显示
- 结果以文本和JSON格式展示
- 提取结果导出和保存

### ⚙️ 系统设置
- AI模型配置和状态监控
- 系统参数设置
- 用户权限管理
- 数据备份和恢复

## 技术架构

### 后端技术
- **Web框架**: Flask 2.3.3
- **数据库**: SQLite3
- **文件处理**: PyPDF2, python-docx
- **AI集成**: Ollama API
- **用户认证**: Werkzeug安全模块

### 前端技术
- **界面**: HTML5 + CSS3 + JavaScript
- **样式**: 自定义CSS（渐变设计、响应式布局）
- **交互**: 原生JavaScript（异步请求、动态更新）
- **用户体验**: 现代化界面设计、流畅动画效果

## 系统要求

### 硬件要求
- **CPU**: 2核心以上
- **内存**: 4GB以上（推荐8GB）
- **存储**: 10GB以上可用空间
- **网络**: 用于下载AI模型和依赖包

### 软件要求
- **操作系统**: Windows 10/11, macOS 10.15+, Linux (Ubuntu 18.04+)
- **Python版本**: 3.8 - 3.11
- **Ollama**: 用于运行AI模型

## 安装部署

### 第一步：环境准备

1. **安装Python**
   ```bash
   # 检查Python版本
   python --version
   # 或者
   python3 --version
   ```

2. **安装Ollama**
   
   访问 [Ollama官网](https://ollama.ai) 下载并安装Ollama
   
   ```bash
   # 安装完成后，拉取推荐的AI模型
   ollama pull deepseek-r1:8b
   ```

### 第二步：项目下载

```bash
# 如果有Git，可以克隆项目
git clone https://github.com/ai4dt/my-audit-tool.git

# 或者直接下载项目文件到本地文件夹
```

### 第三步：创建虚拟环境（推荐）

```bash
# 创建虚拟环境
conda create -n py310 python=3.10

# 激活虚拟环境
# Windows:
conda activate py310
```


### 第四步：安装依赖

```bash
# 进入项目目录
cd audit_system

# 安装所有依赖包
pip install -r requirements.txt

# 如果遇到网络问题，可以使用国内镜像源
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 第五步：创建必要目录

```bash
# 创建模板目录（如果不存在）
mkdir templates

# 创建上传目录（如果不存在）
mkdir uploads
```

### 第六步：文件结构确认

确保项目目录结构如下：
```
audit_system/
├── main.py                 # 主程序文件
├── requirements.txt        # 依赖文件
├── README.md              # 说明文档
├── templates/             # 模板文件夹
│   ├── login.html
│   ├── dashboard.html
│   ├── contracts.html
│   ├── prompts.html
│   ├── extract.html
│   └── settings.html
└── uploads/               # 上传文件夹（自动创建）
```

## 运行系统

### 启动步骤

1. **启动Ollama服务**
   ```bash
   # 在新的命令行窗口中启动Ollama
   ollama serve
   ```

2. **启动审计系统**
   ```bash
   # 在项目目录中运行
   python main.py
   ```

3. **访问系统**
   
   打开浏览器，访问: `http://localhost:5000`

### 默认账户

- **用户名**: admin
- **密码**: admin123
- **角色**: 管理员

## 使用指南

### 1. 登录系统

1. 打开浏览器访问 `http://localhost:5000`
2. 使用默认账户登录（admin/admin123）
3. 成功登录后进入仪表板

### 2. 上传合同文件

1. 点击导航栏的"合同管理"
2. 在上传区域拖拽文件或点击"选择文件"
3. 支持的格式：PDF、DOCX、DOC、TXT
4. 文件上传完成后在列表中查看

### 3. 创建提示词

1. 点击导航栏的"提示词管理"
2. 在左侧"创建提示词"区域
3. 可以使用预设模板或自定义内容
4. 填写提示词名称和内容
5. 点击"创建提示词"保存

### 4. 提取合同信息

1. 点击导航栏的"信息提取"
2. 第一步：选择要分析的合同文件
3. 第二步：选择合适的提示词模板
4. 选择AI模型（推荐DeepSeek-R1:8b）
5. 点击"开始提取"
6. 等待AI分析完成
7. 查看和导出提取结果

### 5. 系统设置

1. 点击导航栏的"系统设置"
2. 配置AI模型参数
3. 调整系统配置
4. 管理用户权限
5. 进行数据备份

## 故障排除

### 常见问题

1. **无法启动系统**
   - 检查Python版本是否正确
   - 确认所有依赖已安装
   - 检查端口5000是否被占用

2. **AI模型无法连接**
   - 确认Ollama服务是否启动
   - 检查Ollama地址配置
   - 确认模型是否已下载

3. **文件上传失败**
   - 检查文件格式是否支持
   - 确认文件大小不超过16MB
   - 检查uploads目录权限

4. **提取结果异常**
   - 检查提示词格式是否正确
   - 确认合同文件内容可读
   - 尝试使用不同的AI模型

### 日志查看

系统运行日志会显示在控制台中，包含：
- 请求记录
- 错误信息
- AI模型调用状态
- 文件处理结果

## 开发说明

### 项目结构

```
audit_system/
├── main.py                 # Flask应用主文件
├── requirements.txt        # Python依赖包
├── README.md              # 项目说明
├── templates/             # HTML模板文件
│   ├── login.html         # 登录页面
│   ├── dashboard.html     # 仪表板
│   ├── contracts.html     # 合同管理
│   ├── prompts.html       # 提示词管理
│   ├── extract.html       # 信息提取
│   └── settings.html      # 系统设置
├── uploads/               # 上传文件存储
├── audit_system.db        # SQLite数据库（运行时创建）
└── static/                # 静态文件（可选）
```

### 数据库结构

系统使用SQLite数据库，包含以下表：

1. **users表** - 用户信息
2. **prompts表** - 提示词模板
3. **contracts表** - 合同文件信息
4. **extractions表** - 提取结果记录

### API接口

主要API端点：
- `POST /login` - 用户登录
- `GET /api/contracts` - 获取合同列表
- `POST /upload_contract` - 上传合同文件
- `GET /api/prompts` - 获取提示词列表
- `POST /api/prompts` - 创建提示词
- `POST /api/extract` - 执行信息提取

## 扩展功能

系统预留了以下扩展接口：

1. **用户管理增强**
   - 用户注册功能
   - 密码重置
   - 权限细化

2. **模型管理**
   - 模型自动更新
   - 多模型并行处理
   - 模型性能监控

3. **结果管理**
   - 提取历史记录
   - 结果对比分析
   - 批量处理功能

4. **系统监控**
   - 性能指标监控
   - 错误报告
   - 使用统计

## 技术支持

如果在使用过程中遇到问题，可以通过以下方式获得帮助：

1. **检查日志**: 查看控制台输出的错误信息
2. **查看文档**: 仔细阅读本README文档
3. **验证环境**: 确认Python版本和依赖包版本
4. **重新部署**: 按照安装步骤重新部署系统

## 版本信息

- **当前版本**: v1.0.0
- **发布日期**: 2025年
- **适用范围**: 中国铁路建设集团内部使用

## 许可证

本项目仅供学习和内部使用，请遵守相关法律法规。

---

**注意事项**：
- 首次运行需要下载AI模型，可能需要较长时间
- 建议在稳定的网络环境下使用
- 定期备份重要数据
- 生产环境请修改默认密码和密钥
